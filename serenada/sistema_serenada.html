<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Serenada Pub & Burger - Sistema</title>

<style>
body{
    margin:0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background:#121212;
    color:#fff;
}

.container{
    max-width:1100px;
    margin:30px auto;
    background:#1e1e1e;
    padding:25px;
    border-radius:12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
}

h1{
    text-align:center;
    color: #03dac6;
    letter-spacing: 2px;
}

.section{
    margin-top:30px;
    padding:15px;
    background:#2a2a2a;
    border-radius:10px;
}

input, select{
    padding:10px;
    margin:5px;
    border-radius: 6px;
    border: 1px solid #444;
    background: #333;
    color: #fff;
    outline: none;
}

input:focus { border-color: #03dac6; }

button{
    padding:10px 15px;
    margin:5px;
    cursor:pointer;
    border:none;
    border-radius:6px;
    font-weight: bold;
    transition: 0.2s;
}

button:hover { opacity: 0.8; transform: translateY(-1px); }

.btn-primary{ background:#03dac6; color: #000; }
.btn-danger{ background:#ff5252; color:#fff; }
.btn-close{ background:#ff4081; color:#fff; }
.btn-warning { background: #ffb100; color: #000; }

table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}

th, td{
    border-bottom:1px solid #444;
    padding:12px;
    text-align:center;
}

th { background: #333; color: #03dac6; }

.total{
    font-weight:bold;
    margin-top:15px;
    font-size: 1.4em;
    color: #03dac6;
    text-align: right;
}

.obs-text {
    font-size: 0.85em;
    color: #aaa;
    font-style: italic;
}

/* Escondido por padr√£o */
#painelDelivery { 
    display: none; 
    border-left: 4px solid #03dac6;
    padding-left: 10px;
    margin: 10px 0;
}
</style>
</head>
<body>

<div id="loginScreen" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#121212; display:flex; justify-content:center; align-items:center; flex-direction:column; z-index:9999;">
    <h2 style="color:#03dac6">üçî Serenada Pub - Acesso</h2>
    <input type="password" id="senhaLogin" placeholder="Senha do Sistema" style="text-align:center; font-size:1.2em">
    <button class="btn-primary" onclick="fazerLogin()" style="width:200px">Entrar</button>
</div>

<div class="container">
    <h1>SERENADA PUB & BURGER</h1>

    <div class="section">
        <h3>üì¶ Cadastro de Estoque</h3>
        <input id="nomeProduto" placeholder="Nome do Produto">
        <input id="precoProduto" type="number" step="0.01" min="0.01" placeholder="Pre√ßo (ex: 25.50)">
        <input id="estoqueProduto" type="number" min="0" placeholder="Qtd Inicial">
        <button class="btn-primary" onclick="cadastrarProduto()">Cadastrar</button>

        <table>
            <thead>
                <tr>
                    <th>Produto</th>
                    <th>Pre√ßo</th>
                    <th>Estoque</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="tabelaEstoque"></tbody>
        </table>
    </div>

    <div class="section">
        <h3>üî• Lan√ßar Pedido</h3>
        <div style="display: flex; flex-wrap: wrap; align-items: center;">
            <select id="mesaSelect" onchange="toggleCliente()">
                </select>

            <div id="painelDelivery">
                <input type="text" id="nomeCliente" placeholder="Nome do Cliente">
                <input type="text" id="endCliente" placeholder="Endere√ßo Completo" style="width: 250px;">
                <input type="number" id="taxaEntrega" placeholder="Taxa Entrega R$" min="0" step="0.50" style="width: 120px;">
            </div>
        </div>

        <div style="margin-top:10px;">
            <select id="produtoSelect"></select>
            <input type="number" id="qtdItem" value="1" min="1" style="width: 70px;">
            <input type="text" id="obsItem" placeholder="Obs: Sem cebola, mal passado..." style="width: 250px;">
            <button class="btn-primary" onclick="adicionarItem()">Adicionar na Conta</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Local/Cliente</th>
                    <th>Produto</th>
                    <th>Obs</th>
                    <th>Qtd</th>
                    <th>Total</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="itensMesa"></tbody>
        </table>

        <div class="total" id="totalMesa">Total: R$ 0.00</div>
        <button class="btn-close" onclick="fecharMesa()">Finalizar e Imprimir Cupom</button>
    </div>

    <div class="section" style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h3>üí∞ Caixa do Dia</h3>
            <div id="totalDia" style="font-size: 1.8em; color: #03dac6;">Total: R$ 0.00</div>
        </div>
        <div>
            <button class="btn-primary" onclick="gerarRelatorioCompleto()">üìä Relat√≥rio</button>
            <button class="btn-danger" onclick="fecharCaixa()">Encerrar Caixa</button>
            <button class="btn-warning" onclick="zerarSistema()">‚ö†Ô∏è Zerar Tudo</button>
        </div>
    </div>
</div>

<script>
const SENHA_SISTEMA = "1234"; // Altere aqui se desejar

let estoque = JSON.parse(localStorage.getItem("estoque")) || [];
let comandas = JSON.parse(localStorage.getItem("comandas")) || {};
let totalDia = JSON.parse(localStorage.getItem("totalDia")) || 0;

function fazerLogin(){
    if(document.getElementById("senhaLogin").value === SENHA_SISTEMA) {
        document.getElementById("loginScreen").style.display="none";
    } else alert("Senha incorreta!");
}

function salvarDados(){
    localStorage.setItem("estoque", JSON.stringify(estoque));
    localStorage.setItem("comandas", JSON.stringify(comandas));
    localStorage.setItem("totalDia", JSON.stringify(totalDia));
}

function toggleCliente() {
    let mesa = mesaSelect.value;
    document.getElementById("painelDelivery").style.display = (mesa === "Delivery") ? "flex" : "none";
    atualizarMesa();
}

function cadastrarProduto(){
    let nome = nomeProduto.value.trim();
    let preco = parseFloat(precoProduto.value);
    let qtd = parseInt(estoqueProduto.value);

    if(!nome || isNaN(preco) || preco <= 0 || isNaN(qtd) || qtd < 0){
        return alert("Preencha valores v√°lidos e positivos!");
    }

    if(estoque.find(p => p.nome.toLowerCase() === nome.toLowerCase())) {
        return alert("Produto j√° cadastrado!");
    }

    estoque.push({nome, preco, qtd});
    salvarDados();
    atualizarEstoque();
    nomeProduto.value = ""; precoProduto.value = ""; estoqueProduto.value = "";
}

function atualizarEstoque(){
    tabelaEstoque.innerHTML="";
    produtoSelect.innerHTML="";
    estoque.forEach((p,i)=>{
        tabelaEstoque.innerHTML+=
        `<tr>
            <td>${p.nome}</td>
            <td>R$ ${p.preco.toFixed(2)}</td>
            <td>
                <button onclick="alterarEstoque(${i}, -1)">‚ûñ</button>
                <strong>${p.qtd}</strong>
                <button onclick="alterarEstoque(${i}, 1)">‚ûï</button>
            </td>
            <td><button class="btn-danger" onclick="excluirProduto(${i})">üóëÔ∏è</button></td>
        </tr>`;
        produtoSelect.innerHTML+= `<option value="${i}">${p.nome}</option>`;
    });
}

function alterarEstoque(i, n){
    if(estoque[i].qtd + n < 0) return alert("Estoque insuficiente!");
    estoque[i].qtd += n;
    salvarDados();
    atualizarEstoque();
}

function excluirProduto(i) {
    if(confirm(`Excluir ${estoque[i].nome}?`)) {
        estoque.splice(i, 1);
        salvarDados();
        atualizarEstoque();
    }
}

function atualizarMesas(){
    mesaSelect.innerHTML = `<option value="todas">Ver Todas</option> <option value="Balc√£o">üìç Balc√£o</option> <option value="Delivery">üõµ Delivery</option>`;
    for(let i=1;i<=20;i++) mesaSelect.innerHTML += `<option value="${i}">Mesa ${i}</option>`;
}

function adicionarItem(){
    let mesaSel = mesaSelect.value;
    if(mesaSel==="todas") return alert("Selecione o destino do pedido");

    let nomeCli = nomeCliente.value.trim();
    let endereco = endCliente.value.trim();
    let taxa = parseFloat(taxaEntrega.value) || 0;

    if(mesaSel === "Delivery" && (!nomeCli || !endereco)) return alert("Para Delivery, nome e endere√ßo s√£o obrigat√≥rios!");
    if(taxa < 0) return alert("A taxa n√£o pode ser negativa!");

    let pIdx = produtoSelect.value;
    let qtd = parseInt(qtdItem.value);
    let produto = estoque[pIdx];

    if(!produto || qtd <= 0) return alert("Verifique o produto e a quantidade!");
    if(produto.qtd < qtd) return alert("Estoque insuficiente!");

    let id = (mesaSel === "Delivery") ? `DELIVERY: ${nomeCli}` : (mesaSel === "Balc√£o" ? "BALC√ÉO" : `MESA ${mesaSel}`);

    if(!comandas[id]) {
        comandas[id] = { itens: [], taxa: 0, endereco: "" };
        if(mesaSel === "Delivery") {
            comandas[id].taxa = taxa;
            comandas[id].endereco = endereco;
        }
    }

    comandas[id].itens.push({
        nome: produto.nome,
        qtd,
        preco: produto.preco,
        total: produto.preco * qtd,
        obs: obsItem.value.trim()
    });

    produto.qtd -= qtd;
    obsItem.value = "";
    salvarDados();
    atualizarEstoque();
    atualizarMesa();
}

function atualizarMesa(){
    let mesaSel = mesaSelect.value;
    let nomeCli = nomeCliente.value.trim();
    let idBusca = (mesaSel === "Delivery") ? `DELIVERY: ${nomeCli}` : (mesaSel === "Balc√£o" ? "BALC√ÉO" : `MESA ${mesaSel}`);
    
    itensMesa.innerHTML="";
    let totalGeral=0;

    const renderLinhas = (id) => {
        let subtotal = 0;
        comandas[id].itens.forEach((item, index) => {
            subtotal += item.total;
            itensMesa.innerHTML += `<tr><td>${id}</td><td>${item.nome}</td><td class="obs-text">${item.obs || "-"}</td><td>${item.qtd}</td><td>R$ ${item.total.toFixed(2)}</td>
            <td><button class="btn-danger" onclick="removerItem('${id}',${index})">‚ùå</button></td></tr>`;
        });
        if(comandas[id].taxa > 0) {
            itensMesa.innerHTML += `<tr style="color:#03dac6"><td>-</td><td>TAXA DE ENTREGA</td><td colspan="2">${comandas[id].endereco}</td><td>R$ ${comandas[id].taxa.toFixed(2)}</td><td></td></tr>`;
            subtotal += comandas[id].taxa;
        }
        return subtotal;
    };

    if(mesaSel === "todas"){
        for(let id in comandas) totalGeral += renderLinhas(id);
    } else if(comandas[idBusca]){
        totalGeral = renderLinhas(idBusca);
    }
    
    totalMesa.innerHTML = "Total: R$ " + totalGeral.toFixed(2);
}

function removerItem(id, idx){
    let item = comandas[id].itens[idx];
    let p = estoque.find(p=>p.nome===item.nome);
    if(p) p.qtd += item.qtd;
    comandas[id].itens.splice(idx,1);
    if(comandas[id].itens.length===0) delete comandas[id];
    salvarDados(); atualizarEstoque(); atualizarMesa();
}

function fecharMesa(){
    let mesaSel = mesaSelect.value;
    let nomeCli = nomeCliente.value.trim();
    let idBusca = (mesaSel === "Delivery") ? `DELIVERY: ${nomeCli}` : (mesaSel === "Balc√£o" ? "BALC√ÉO" : `MESA ${mesaSel}`);

    if(!comandas[idBusca]) return alert("Selecione uma conta aberta.");

    let pag = prompt("Pagamento:\n1-Dinheiro | 2-Pix | 3-Cart√£o");
    let formas = {"1":"Dinheiro", "2":"Pix", "3":"Cart√£o"};
    if(!formas[pag]) return alert("Cancelado.");

    let totalItens = comandas[idBusca].itens.reduce((s,i)=>s+i.total,0);
    let totalFinal = totalItens + comandas[idBusca].taxa;

    imprimirCupom(idBusca, comandas[idBusca], totalFinal);
    
    totalDia += totalFinal;
    delete comandas[idBusca];
    if(mesaSel === "Delivery") { nomeCliente.value=""; endCliente.value=""; taxaEntrega.value=""; }

    salvarDados(); atualizarMesa(); atualizarTotalDia();
}

function imprimirCupom(id, obj, total){
    let janela = window.open("", "", "width=300,height=600");
    let cupom = `<pre style="font-family:monospace">
SERENADA PUB & BURGER
----------------------------
PEDIDO: ${id}
DATA: ${new Date().toLocaleString()}
----------------------------\n`;
    
    obj.itens.forEach(i => {
        cupom += `${i.qtd}x ${i.nome.padEnd(15)} R$${i.total.toFixed(2)}\n`;
        if(i.obs) cupom += `  * ${i.obs}\n`;
    });

    if(obj.taxa > 0) {
        cupom += `----------------------------\n`;
        cupom += `ENTREGA: R$ ${obj.taxa.toFixed(2)}\n`;
        cupom += `END: ${obj.endereco}\n`;
    }

    cupom += `----------------------------
TOTAL: R$ ${total.toFixed(2)}
----------------------------
Obrigado pela prefer√™ncia!
</pre>`;
    janela.document.write(cupom);
    janela.print();
    janela.close();
}

function zerarSistema() {
    if(prompt("Senha Mestre:") === SENHA_SISTEMA) {
        if(confirm("Zerar todas as vendas e mesas?")) {
            comandas = {}; totalDia = 0;
            localStorage.removeItem("historico");
            salvarDados(); location.reload();
        }
    } else alert("Senha incorreta!");
}

function atualizarTotalDia(){
    document.getElementById("totalDia").innerHTML="Total: R$ "+totalDia.toFixed(2);
}

function fecharCaixa(){
    if(totalDia === 0) return alert("Sem vendas!");
    let rel = `SERENADA PUB - FECHAMENTO\nDATA: ${new Date().toLocaleString()}\nTOTAL: R$ ${totalDia.toFixed(2)}`;
    let blob = new Blob([rel], { type: "text/plain" });
    let link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `caixa.txt`;
    link.click();
}

function gerarRelatorioCompleto(){
    alert("Fun√ß√£o de relat√≥rio em texto baixada via 'Encerrar Caixa'.");
}

atualizarEstoque();
atualizarMesas();
atualizarTotalDia();
</script>
</body>
</html>
